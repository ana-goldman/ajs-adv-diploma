!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=73)}([function(t,e,r){(function(e){var r=function(t){return t&&t.Math==Math&&t};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,r(44))},function(t,e,r){var n=r(14),a={}.hasOwnProperty;t.exports=Object.hasOwn||function(t,e){return a.call(n(t),e)}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,r){var n=r(5),a=r(6),o=r(13);t.exports=n?function(t,e,r){return a.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t}},function(t,e,r){var n=r(0),a=r(24),o=r(1),i=r(28),s=r(29),c=r(50),l=a("wks"),u=n.Symbol,h=c?u:u&&u.withoutSetter||i;t.exports=function(t){return o(l,t)&&(s||"string"==typeof l[t])||(s&&o(u,t)?l[t]=u[t]:l[t]=h("Symbol."+t)),l[t]}},function(t,e,r){var n=r(2);t.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,e,r){var n=r(5),a=r(25),o=r(8),i=r(27),s=Object.defineProperty;e.f=n?s:function(t,e,r){if(o(t),e=i(e,!0),o(r),a)try{return s(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,r){var n=r(7);t.exports=function(t){if(!n(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,r){var n=r(21),a=r(23);t.exports=function(t){return n(a(t))}},function(t,e){t.exports=!1},function(t,e,r){var n=r(0),a=r(12),o=n["__core-js_shared__"]||a("__core-js_shared__",{});t.exports=o},function(t,e,r){var n=r(0),a=r(3);t.exports=function(t,e){try{a(n,t,e)}catch(r){n[t]=e}return e}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,r){var n=r(23);t.exports=function(t){return Object(n(t))}},function(t,e,r){var n=r(49),a=r(0),o=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?o(n[t])||o(a[t]):n[t]&&n[t][e]||a[t]&&a[t][e]}},function(t,e){t.exports={}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e,r){var n=r(24),a=r(28),o=n("keys");t.exports=function(t){return o[t]||(o[t]=a(t))}},function(t,e){t.exports={}},function(t,e,r){var n=r(0),a=r(45),o=r(46),i=r(3),s=r(4),c=s("iterator"),l=s("toStringTag"),u=o.values;for(var h in a){var f=n[h],d=f&&f.prototype;if(d){if(d[c]!==u)try{i(d,c,u)}catch(t){d[c]=u}if(d[l]||i(d,l,h),a[h])for(var p in o)if(d[p]!==o[p])try{i(d,p,o[p])}catch(t){d[p]=o[p]}}}},function(t,e,r){var n=r(2),a=r(22),o="".split;t.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==a(t)?o.call(t,""):Object(t)}:Object},function(t,e){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,r){var n=r(10),a=r(11);(t.exports=function(t,e){return a[t]||(a[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.15.2",mode:n?"pure":"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})},function(t,e,r){var n=r(5),a=r(2),o=r(26);t.exports=!n&&!a((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(t,e,r){var n=r(0),a=r(7),o=n.document,i=a(o)&&a(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,e,r){var n=r(7);t.exports=function(t,e){if(!n(t))return t;var r,a;if(e&&"function"==typeof(r=t.toString)&&!n(a=r.call(t)))return a;if("function"==typeof(r=t.valueOf)&&!n(a=r.call(t)))return a;if(!e&&"function"==typeof(r=t.toString)&&!n(a=r.call(t)))return a;throw TypeError("Can't convert object to primitive value")}},function(t,e){var r=0,n=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++r+n).toString(36)}},function(t,e,r){var n=r(30),a=r(2);t.exports=!!Object.getOwnPropertySymbols&&!a((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(t,e,r){var n,a,o=r(0),i=r(48),s=o.process,c=s&&s.versions,l=c&&c.v8;l?a=(n=l.split("."))[0]<4?1:n[0]+n[1]:i&&(!(n=i.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=i.match(/Chrome\/(\d+)/))&&(a=n[1]),t.exports=a&&+a},function(t,e,r){var n,a=r(8),o=r(51),i=r(17),s=r(16),c=r(55),l=r(26),u=r(18),h=u("IE_PROTO"),f=function(){},d=function(t){return"<script>"+t+"<\/script>"},p=function(){try{n=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;p=n?function(t){t.write(d("")),t.close();var e=t.parentWindow.Object;return t=null,e}(n):((e=l("iframe")).style.display="none",c.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(d("document.F=Object")),t.close(),t.F);for(var r=i.length;r--;)delete p.prototype[i[r]];return p()};s[h]=!0,t.exports=Object.create||function(t,e){var r;return null!==t?(f.prototype=a(t),r=new f,f.prototype=null,r[h]=t):r=p(),void 0===e?r:o(r,e)}},function(t,e,r){var n=r(1),a=r(9),o=r(53).indexOf,i=r(16);t.exports=function(t,e){var r,s=a(t),c=0,l=[];for(r in s)!n(i,r)&&n(s,r)&&l.push(r);for(;e.length>c;)n(s,r=e[c++])&&(~o(l,r)||l.push(r));return l}},function(t,e,r){var n=r(34),a=Math.min;t.exports=function(t){return t>0?a(n(t),9007199254740991):0}},function(t,e){var r=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:r)(t)}},function(t,e,r){var n,a,o,i=r(56),s=r(0),c=r(7),l=r(3),u=r(1),h=r(11),f=r(18),d=r(16),p=s.WeakMap;if(i||h.state){var m=h.state||(h.state=new p),v=m.get,y=m.has,g=m.set;n=function(t,e){if(y.call(m,t))throw new TypeError("Object already initialized");return e.facade=t,g.call(m,t,e),e},a=function(t){return v.call(m,t)||{}},o=function(t){return y.call(m,t)}}else{var b=f("state");d[b]=!0,n=function(t,e){if(u(t,b))throw new TypeError("Object already initialized");return e.facade=t,l(t,b,e),e},a=function(t){return u(t,b)?t[b]:{}},o=function(t){return u(t,b)}}t.exports={set:n,get:a,has:o,enforce:function(t){return o(t)?a(t):n(t,{})},getterFor:function(t){return function(e){var r;if(!c(e)||(r=a(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}}},function(t,e,r){var n=r(11),a=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(t){return a.call(t)}),t.exports=n.inspectSource},function(t,e,r){var n=r(0),a=r(38).f,o=r(3),i=r(39),s=r(12),c=r(59),l=r(63);t.exports=function(t,e){var r,u,h,f,d,p=t.target,m=t.global,v=t.stat;if(r=m?n:v?n[p]||s(p,{}):(n[p]||{}).prototype)for(u in e){if(f=e[u],h=t.noTargetGet?(d=a(r,u))&&d.value:r[u],!l(m?u:p+(v?".":"#")+u,t.forced)&&void 0!==h){if(typeof f==typeof h)continue;c(f,h)}(t.sham||h&&h.sham)&&o(f,"sham",!0),i(r,u,f,t)}}},function(t,e,r){var n=r(5),a=r(58),o=r(13),i=r(9),s=r(27),c=r(1),l=r(25),u=Object.getOwnPropertyDescriptor;e.f=n?u:function(t,e){if(t=i(t),e=s(e,!0),l)try{return u(t,e)}catch(t){}if(c(t,e))return o(!a.f.call(t,e),t[e])}},function(t,e,r){var n=r(0),a=r(3),o=r(1),i=r(12),s=r(36),c=r(35),l=c.get,u=c.enforce,h=String(String).split("String");(t.exports=function(t,e,r,s){var c,l=!!s&&!!s.unsafe,f=!!s&&!!s.enumerable,d=!!s&&!!s.noTargetGet;"function"==typeof r&&("string"!=typeof e||o(r,"name")||a(r,"name",e),(c=u(r)).source||(c.source=h.join("string"==typeof e?e:""))),t!==n?(l?!d&&t[e]&&(f=!0):delete t[e],f?t[e]=r:a(t,e,r)):f?t[e]=r:i(e,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&l(this).source||s(this)}))},function(t,e,r){"use strict";var n,a,o,i=r(2),s=r(41),c=r(3),l=r(1),u=r(4),h=r(10),f=u("iterator"),d=!1;[].keys&&("next"in(o=[].keys())?(a=s(s(o)))!==Object.prototype&&(n=a):d=!0);var p=null==n||i((function(){var t={};return n[f].call(t)!==t}));p&&(n={}),h&&!p||l(n,f)||c(n,f,(function(){return this})),t.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:d}},function(t,e,r){var n=r(1),a=r(14),o=r(18),i=r(65),s=o("IE_PROTO"),c=Object.prototype;t.exports=i?Object.getPrototypeOf:function(t){return t=a(t),n(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?c:null}},function(t,e,r){var n=r(6).f,a=r(1),o=r(4)("toStringTag");t.exports=function(t,e,r){t&&!a(t=r?t:t.prototype,o)&&n(t,o,{configurable:!0,value:e})}},function(t,e,r){},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,e,r){"use strict";var n=r(9),a=r(47),o=r(19),i=r(35),s=r(57),c=i.set,l=i.getterFor("Array Iterator");t.exports=s(Array,"Array",(function(t,e){c(this,{type:"Array Iterator",target:n(t),index:0,kind:e})}),(function(){var t=l(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:e[n],done:!1}:{value:[n,e[n]],done:!1}}),"values"),o.Arguments=o.Array,a("keys"),a("values"),a("entries")},function(t,e,r){var n=r(4),a=r(31),o=r(6),i=n("unscopables"),s=Array.prototype;null==s[i]&&o.f(s,i,{configurable:!0,value:a(null)}),t.exports=function(t){s[i][t]=!0}},function(t,e,r){var n=r(15);t.exports=n("navigator","userAgent")||""},function(t,e,r){var n=r(0);t.exports=n},function(t,e,r){var n=r(29);t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,r){var n=r(5),a=r(6),o=r(8),i=r(52);t.exports=n?Object.defineProperties:function(t,e){o(t);for(var r,n=i(e),s=n.length,c=0;s>c;)a.f(t,r=n[c++],e[r]);return t}},function(t,e,r){var n=r(32),a=r(17);t.exports=Object.keys||function(t){return n(t,a)}},function(t,e,r){var n=r(9),a=r(33),o=r(54),i=function(t){return function(e,r,i){var s,c=n(e),l=a(c.length),u=o(i,l);if(t&&r!=r){for(;l>u;)if((s=c[u++])!=s)return!0}else for(;l>u;u++)if((t||u in c)&&c[u]===r)return t||u||0;return!t&&-1}};t.exports={includes:i(!0),indexOf:i(!1)}},function(t,e,r){var n=r(34),a=Math.max,o=Math.min;t.exports=function(t,e){var r=n(t);return r<0?a(r+e,0):o(r,e)}},function(t,e,r){var n=r(15);t.exports=n("document","documentElement")},function(t,e,r){var n=r(0),a=r(36),o=n.WeakMap;t.exports="function"==typeof o&&/native code/.test(a(o))},function(t,e,r){"use strict";var n=r(37),a=r(64),o=r(41),i=r(66),s=r(42),c=r(3),l=r(39),u=r(4),h=r(10),f=r(19),d=r(40),p=d.IteratorPrototype,m=d.BUGGY_SAFARI_ITERATORS,v=u("iterator"),y=function(){return this};t.exports=function(t,e,r,u,d,g,b){a(r,e,u);var w,x,P,S=function(t){if(t===d&&O)return O;if(!m&&t in k)return k[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},L=e+" Iterator",C=!1,k=t.prototype,E=k[v]||k["@@iterator"]||d&&k[d],O=!m&&E||S(d),T="Array"==e&&k.entries||E;if(T&&(w=o(T.call(new t)),p!==Object.prototype&&w.next&&(h||o(w)===p||(i?i(w,p):"function"!=typeof w[v]&&c(w,v,y)),s(w,L,!0,!0),h&&(f[L]=y))),"values"==d&&E&&"values"!==E.name&&(C=!0,O=function(){return E.call(this)}),h&&!b||k[v]===O||c(k,v,O),f[e]=O,d)if(x={values:S("values"),keys:g?O:S("keys"),entries:S("entries")},b)for(P in x)(m||C||!(P in k))&&l(k,P,x[P]);else n({target:e,proto:!0,forced:m||C},x);return x}},function(t,e,r){"use strict";var n={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,o=a&&!n.call({1:2},1);e.f=o?function(t){var e=a(this,t);return!!e&&e.enumerable}:n},function(t,e,r){var n=r(1),a=r(60),o=r(38),i=r(6);t.exports=function(t,e){for(var r=a(e),s=i.f,c=o.f,l=0;l<r.length;l++){var u=r[l];n(t,u)||s(t,u,c(e,u))}}},function(t,e,r){var n=r(15),a=r(61),o=r(62),i=r(8);t.exports=n("Reflect","ownKeys")||function(t){var e=a.f(i(t)),r=o.f;return r?e.concat(r(t)):e}},function(t,e,r){var n=r(32),a=r(17).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,a)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,r){var n=r(2),a=/#|\.prototype\./,o=function(t,e){var r=s[i(t)];return r==l||r!=c&&("function"==typeof e?n(e):!!e)},i=o.normalize=function(t){return String(t).replace(a,".").toLowerCase()},s=o.data={},c=o.NATIVE="N",l=o.POLYFILL="P";t.exports=o},function(t,e,r){"use strict";var n=r(40).IteratorPrototype,a=r(31),o=r(13),i=r(42),s=r(19),c=function(){return this};t.exports=function(t,e,r){var l=e+" Iterator";return t.prototype=a(n,{next:o(1,r)}),i(t,l,!1,!0),s[l]=c,t}},function(t,e,r){var n=r(2);t.exports=!n((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,e,r){var n=r(8),a=r(67);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),e=r instanceof Array}catch(t){}return function(r,o){return n(r),a(o),e?t.call(r,o):r.__proto__=o,r}}():void 0)},function(t,e,r){var n=r(7);t.exports=function(t){if(!n(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},function(t,e,r){"use strict";var n=r(37),a=r(69).left,o=r(71),i=r(30),s=r(72);n({target:"Array",proto:!0,forced:!o("reduce")||!s&&i>79&&i<83},{reduce:function(t){return a(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(t,e,r){var n=r(70),a=r(14),o=r(21),i=r(33),s=function(t){return function(e,r,s,c){n(r);var l=a(e),u=o(l),h=i(l.length),f=t?h-1:0,d=t?-1:1;if(s<2)for(;;){if(f in u){c=u[f],f+=d;break}if(f+=d,t?f<0:h<=f)throw TypeError("Reduce of empty array with no initial value")}for(;t?f>=0:h>f;f+=d)f in u&&(c=r(c,u[f],f,l));return c}};t.exports={left:s(!1),right:s(!0)}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},function(t,e,r){"use strict";var n=r(2);t.exports=function(t,e){var r=[][t];return!!r&&n((function(){r.call(null,e||function(){throw 1},1)}))}},function(t,e,r){var n=r(22),a=r(0);t.exports="process"==n(a.process)},function(t,e,r){"use strict";r.r(e);r(43),r(20);function n(t,e){switch(t){case 0:return"top-left";case e-1:return"top-right";case e*e-1:return"bottom-right";case e*e-e:return"bottom-left"}for(;t<=e-1;)return"top";for(;t>=e*e-e;)return"bottom";for(let r=e;r<=e*(e-2);r+=e)if(r===t)return"left";for(let r=e+e-1;r<=e*e-e;r+=e)if(r===t)return"right";return"center"}class a{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",t=>this.onNewGameClick(t)),this.saveGameEl.addEventListener("click",t=>this.onSaveGameClick(t)),this.loadGameEl.addEventListener("click",t=>this.onLoadGameClick(t)),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const e=document.createElement("div");e.classList.add("cell","map-tile","map-tile-"+n(t,this.boardSize)),e.addEventListener("mouseenter",t=>this.onCellEnter(t)),e.addEventListener("mouseleave",t=>this.onCellLeave(t)),e.addEventListener("click",t=>this.onCellClick(t)),this.boardEl.appendChild(e)}this.cells=Array.from(this.boardEl.children)}redrawPositions(t){for(const t of this.cells)t.innerHTML="";for(const r of t){const t=this.boardEl.children[r.position],n=document.createElement("div");n.classList.add("character",r.character.type);const a=document.createElement("div");a.classList.add("health-level");const o=document.createElement("div");o.classList.add("health-level-indicator","health-level-indicator-"+((e=r.character.health)<15?"critical":e<50?"normal":"high")),o.style.width=r.character.health+"%",a.appendChild(o),n.appendChild(a),t.appendChild(n)}var e}addCellEnterListener(t){this.cellEnterListeners.push(t)}addCellLeaveListener(t){this.cellLeaveListeners.push(t)}addCellClickListener(t){this.cellClickListeners.push(t)}addNewGameListener(t){this.newGameListeners.push(t)}addSaveGameListener(t){this.saveGameListeners.push(t)}addLoadGameListener(t){this.loadGameListeners.push(t)}onCellEnter(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach(t=>t.call(null,e))}onCellLeave(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach(t=>t.call(null,e))}onCellClick(t){const e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach(t=>t.call(null,e))}onNewGameClick(t){t.preventDefault(),this.newGameListeners.forEach(t=>t.call(null))}onSaveGameClick(t){t.preventDefault(),this.saveGameListeners.forEach(t=>t.call(null))}onLoadGameClick(t){t.preventDefault(),this.loadGameListeners.forEach(t=>t.call(null))}static showError(t){alert(t)}static showMessage(t){alert(t)}selectCell(t,e="yellow"){this.deselectCell(t),this.cells[t].classList.add("selected","selected-"+e)}deselectCell(t){const e=this.cells[t];e.classList.remove(...Array.from(e.classList).filter(t=>t.startsWith("selected")))}showCellTooltip(t,e){this.cells[e].title=t}hideCellTooltip(t){this.cells[t].title=""}showDamage(t,e){return new Promise(r=>{const n=this.cells[t],a=document.createElement("span");a.textContent=e,a.classList.add("damage"),n.appendChild(a),a.addEventListener("animationend",()=>{n.removeChild(a),r()})})}setCursor(t){this.boardEl.style.cursor=t}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}getPossibleMove(t,e){const r=[],n=Math.floor(t/8)+1,a=Math.floor(t%8)+1;for(let o=1;o<=e;o+=1){n-o>0&&r.push(t-8*o),n+o<9&&r.push(t+8*o),a-o>0&&r.push(t-o),a+o<9&&r.push(t+o);for(let i=1;i<=e;i+=1)n-o>0&&a-i>0&&r.push(t-8*o-i),n-o>0&&a+i<9&&r.push(t-8*o+i),n+o<9&&a-i>0&&r.push(t+8*o-i),n+o<9&&a+i<9&&r.push(t+8*o+i)}return r}}r(68);var o={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};class i{constructor(t,e="generic"){if(new.target===i)throw new Error("Ð½ÐµÐ»ÑÐ·Ñ ÑÐ¾Ð·Ð´Ð°ÑÑ Character,Ð¿Ð¾Ð¿ÑÐ¾Ð±ÑÐ¹ÑÐµ Ð´ÑÑÐ³Ð¾Ð¹ ÐºÐ»Ð°ÑÑ");this.level=t,this.attack=0,this.defence=0,this.health=50,this.type=e}}class s extends i{constructor(t){super(t,"bowman"),this.attack=25,this.defence=25,this.distance=2,this.attackRadius=2}}class c extends i{constructor(t){super(t,"swordsman"),this.attack=40,this.defence=10,this.distance=4,this.attackRadius=1}}class l extends i{constructor(t){super(t,"magician"),this.attack=10,this.defence=40,this.distance=1,this.attackRadius=4}}class u extends i{constructor(t){super(t,"vampire"),this.attack=25,this.defence=25,this.distance=2,this.attackRadius=2}}class h extends i{constructor(t){super(t,"undead"),this.attack=40,this.defence=10,this.distance=4,this.attackRadius=1}}class f extends i{constructor(t){super(t,"daemon"),this.attack=10,this.defence=40,this.distance=1,this.attackRadius=4}}class d{constructor(){this.team=[]}}const p=new d,m=new d;class v{constructor(t,e){if(!(t instanceof i))throw new Error("character must be instance of Character or its children");if("number"!=typeof e)throw new Error("position must be a number");this.character=t,this.position=e}}function*y(t,e){!function(t){for(let e=t.length-1;e>0;e-=1){const r=Math.floor(Math.random()*(e+1)),n=t[r];t[r]=t[e],t[e]=n}}(t);for(let r=0;r<t.length;r+=1){const n=Math.floor(Math.random()*(Math.floor(e)-Math.ceil(1)))+Math.ceil(1);yield new t[r](n)}}function g(t,e,r,n){for(let a=0;a<r;a+=1){const r=y(t,e).next();if(n===p){const t=b(p)[w(16)];p.team.push(new v(r.value,t))}else{const t=b(m)[w(16)];m.team.push(new v(r.value,t))}}}function b(t){const e=[],r=t===p?0:6;for(let t=0;t<=7;t+=1)e.push(r+8*t),e.push(r+1+8*t);return e}function w(t){return Math.floor(Math.random()*t)}class x{static from(t){return this.playerTeam=t.playerTeam,this.computerTeam=t.computerTeam,this.level=t.level,this.score=t.score,this.maxScore=t.maxScore,null}}var P={auto:"auto",pointer:"pointer",crosshair:"crosshair",notallowed:"not-allowed"};class S{constructor(t,e){this.gamePlay=t,this.stateService=e,this.selectedPlayer=void 0,this.selectedIndex=null}init(){this.themeSet(),this.teamSet(),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGameClick.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGameClick.bind(this)),x.from({playerTeam:p,computerTeam:m,level:0,score:0,maxScore:0})}checkGameState(){0===p.team.length&&a.showMessage("Game over"),0===m.team.length&&(x.level+=1,x.score=p.team.reduce((t,e)=>t+e.character.health,x.score),x.maxScore<x.score&&(x.maxScore=x.score),S.levelUp(),this.themeSet(x.level),this.teamSet(x.level),x.level>=4&&a.showMessage("You win!"))}themeSet(t){switch(t){default:this.gamePlay.drawUi(o.prairie);break;case 1:this.gamePlay.drawUi(o.desert);break;case 2:this.gamePlay.drawUi(o.arctic);break;case 3:this.gamePlay.drawUi(o.mountain)}}teamSet(t){switch(t){default:g([s,c],1,2,p),g([u,h,f],1,2,m),this.gamePlay.redrawPositions(p.team.concat(m.team));break;case 1:g([s,c,l],1,1,p),g([u,h,f],2,p.team.length,m),this.gamePlay.redrawPositions(p.team.concat(m.team));break;case 2:g([s,c,l],2,1,p),g([u,h,f],3,p.team.length,m),this.gamePlay.redrawPositions(p.team.concat(m.team));break;case 3:g([s,c,l],3,1,p),g([u,h,f],4,p.team.length,m),this.gamePlay.redrawPositions(p.team.concat(m.team))}}onNewGameClick(){x.score=0,x.level=0,p.team=[],m.team=[],this.themeSet(),this.teamSet()}onSaveGameClick(){const t={playerTeam:x.playerTeam,computerTeam:x.computerTeam,level:x.level,score:x.score,maxScore:x.maxScore};this.stateService.save(t),a.showMessage("Game saved")}onLoadGameClick(){const t=this.stateService.load();p.team=t.playerTeam.team,m.team=t.computerTeam.team,this.themeSet(t.level),this.gamePlay.redrawPositions(t.playerTeam.team.concat(t.computerTeam.team))}onCellClick(t){const e=this.gamePlay.cells[t].querySelector(".character");if(null!==e)if(e.classList.contains("bowman")||e.classList.contains("swordsman")||e.classList.contains("magician"))this.gamePlay.cells[t].classList.contains("selected-yellow")?(this.gamePlay.deselectCell(t),this.selectedIndex=null,this.selectedPlayer=void 0):(this.gamePlay.selectCell(t),void 0!==this.selectedIndex&&null!==this.selectedIndex&&this.gamePlay.deselectCell(this.selectedIndex),this.selectedIndex=t,this.selectedPlayer=p.team.find(e=>e.position===t));else if(void 0===this.selectedPlayer)a.showError("Pay attention! This is not your character");else if(this.gamePlay.boardEl.style.cursor===P.notallowed)a.showError("Pay attention! This character is too far to attack!");else{const e=m.team.find(e=>e.position===t);this.gamePlay.getPossibleMove(this.selectedIndex,this.selectedPlayer.character.attackRadius).includes(t)&&(this.attack(t,this.selectedPlayer,e),this.gamePlay.deselectCell(t)),setTimeout(()=>{this.computerAction(),this.checkGameState()},800)}else void 0!==this.selectedPlayer&&this.gamePlay.getPossibleMove(this.selectedIndex,this.selectedPlayer.character.distance).includes(t)&&(this.gamePlay.deselectCell(this.selectedIndex),this.selectedIndex=null,this.selectedPlayer.position=t,this.gamePlay.redrawPositions(p.team.concat(m.team)),this.selectedPlayer=void 0,setTimeout(()=>{this.computerAction()},800))}onCellEnter(t){const e=this.gamePlay.cells[t].querySelector(".character"),r=p.team.find(e=>e.position===t),n=m.team.find(e=>e.position===t);if(null!==e&&(void 0===r&&(this.gamePlay.setCursor("not-allowed"),this.gamePlay.showCellTooltip(`ð ${n.character.level} â ${n.character.attack} ð¡ ${n.character.defence} â¤ ${n.character.health}`,t)),void 0===n&&(this.gamePlay.setCursor("pointer"),this.gamePlay.showCellTooltip(`ð ${r.character.level} â ${r.character.attack} ð¡ ${r.character.defence} â¤ ${r.character.health}`,t))),!e&&void 0!==this.selectedPlayer){const{distance:e}=this.selectedPlayer.character,r=this.gamePlay.getPossibleMove(this.selectedIndex,e);for(const e of r)t===e&&this.gamePlay.selectCell(t,"green")}if(void 0!==this.selectedPlayer&&null!==e&&n){const{attackRadius:e}=this.selectedPlayer.character,r=this.gamePlay.getPossibleMove(this.selectedIndex,e);for(const e of r)t===e&&(this.gamePlay.selectCell(t,"red"),this.gamePlay.setCursor("crosshair"))}}onCellLeave(t){this.gamePlay.setCursor("auto"),this.gamePlay.hideCellTooltip(t),this.gamePlay.cells[t].classList.contains("selected-yellow")||this.gamePlay.deselectCell(t)}async attack(t,e,r){const n=Math.max(e.character.attack-r.character.defence,.1*e.character.attack);r.character.health-=n,r.character.health<=0&&(r.character.health=0,m.team=m.team.filter(e=>e.position!==t),p.team=p.team.filter(e=>e.position!==t)),null!==this.selectedIndex&&this.gamePlay.deselectCell(this.selectedIndex),this.selectedPlayer=void 0,this.selectedIndex=null,this.gamePlay.showDamage(t,n).then(()=>{this.checkGameState(),this.gamePlay.redrawPositions(p.team.concat(m.team))})}async computerAction(){let t=m.team.map(t=>{const e=p.team.reduce((e,r)=>{if(this.gamePlay.getPossibleMove(t.position,t.character.attackRadius).includes(r.position))return r});return[t,e]});if(t=t.filter(t=>!t.includes(void 0)),0!==t.length)t.length>1&&t.sort((t,e)=>{let r=0;return Math.max(t[0].character.attack-t[1].character.defence,.1*t[0].character.attack)>Math.max(e[0].character.attack-e[1].character.defence,.1*e[0].character.attack)&&(r=-1),r}),[[this.selectedCharacter,this.chosenCharacter]]=t,this.attack(this.chosenCharacter.position,this.selectedCharacter,this.chosenCharacter);else{const t=[];p.team.forEach(e=>t.push(e.position)),m.team.forEach(e=>t.push(e.position));const e=m.team[Math.floor(Math.random()*m.team.length)],r=this.gamePlay.getPossibleMove(e.position,e.character.distance);do{e.position=r[Math.floor(Math.random()*r.length)]}while(t.includes(e.position));this.gamePlay.redrawPositions(p.team.concat(m.team))}}static levelUp(){p.team.forEach(t=>{t.character.attack=Math.max(t.character.attack,t.character.attack*(1.8-t.character.health)/100),t.character.level+=1,t.character.health+=80,t.character.health>=100&&(t.character.health=100)})}}const L=new a;L.bindToDOM(document.querySelector("#game-container"));const C=new class{constructor(t){this.storage=t}save(t){this.storage.setItem("state",JSON.stringify(t))}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}(localStorage);new S(L,C).init()}]);